
create table area(
  area_id serial primary key,
  name varchar(100) not null,
  delivery_fee decimal(10,2) check(deilvery_fee >=0),
  delivery_count int default 0
);

create table time_slots(
  time_slot_id int primary key serial,
  start_time TIME not null,
  end_time TIME not null,
  max_capacity int default 10,
  check(start_time < end_time)
);

create table person(
  person_id int primary key serial,
  name varchar(100) not null,
  email varchar(100) unique not null,
  phone varchar(20) not null,
  role varchar(50) check (role in ('user','admin','seller','rider'))
);

create table "users" (
  user_id int primary key,
  loyalty_points int default 0,
  products_ordered int default 0,
  foreign key (user_id) references person(person_id) on delete cascade
);

create table admin(
  admin_id int primary key,
  foreign key (admi_id) references person(person_id) on delete cascade
);

create table rider(
  rider_id int primary key,
  rating decimal(3,2) check(rating>=0.0 and rating<=5),
  orders_delivered int default 0,
  vehicle_type varchar(50),
  foreign key (rider_id) references person(person_id) on delete cascade
);

create table seller(
  seller_id int primary key,
  company_name varchar(100),
  orders_delivered int default 0,
  foreign key (seller_id) references person(person_id) on delete cascade
);

create table address(
  address_id int primary key serial,
  street varchar(255) not null,
  city varchar(100),
  division VARCHAR(50),
  zip VARCHAR(20),
  post_office VARCHAR(100),
  label VARCHAR(50),
  area_id INT not null,
  foreign key (area_id) references area(area_id)
);

create table person_address(
  person_id int not null,
  address_id int not null,
  label varchar(50),
  foreign key person_id references person(person_id) on delete cascade,
  foreign key address_id references address(address_id) on delete cascade,
  primary key (person_id,address_id)
);

create table category (
  category_id int primary key serial,
  name varchar(100) not null,
  image_url varchar(255) not null,
  parent_id int,
  foreign key parent_id references category(category_id)
);

create table product_offer(
  product_offer_id int primary key serial,
  offer_type varchar(50),
  amount decimal(10,2),
  percentage decimal(10,2),
  expiry_date date
);

create table products(
  product_id int primary key serial,
  name varchar(100) not null,
  description text,
  unit varchar(20),
  unit_price decimal(10,2) not null check(unit_price>=0),
  stock INT default 0 check(stock>=0),
  rating decimal(3,2) default 0.0,
  image_url varchar(255),
  sell_count int default 0,
  product_offer_id int,
  category_id int not null,
  foreign key product_offer_id references product_offer(product_offer_id) on delete set null,
  foreign key category_id references catagories(catagory_id)
);

create table cart(
  card_id int primary key serial,
  total_cost decimal(10,2) default 0.0,
  discount decimal(10,2) default 0.0,
  delivery_fee decimal(10,2) default 0.0,
  user_id int unique not null,
  foreign key (user_id) references users(user_id) on delete cascade
);

create table Cart_Items (
    cart_id int,
    product_id int,
    quantity int not null check(quantity>0),
    price decimal(10, 2) not null,
    add_time time default current_time,
    primary key (cart_id,product_id),
    foreign key (cart_id) references cart(cart_id) on delete cascade,
    foreign key (product_id) references products(product_id) on delete cascade
);

create table order_offer(
  offer_id int primary key serial,
  coupon_code varchar(255) unique,
  offer_type varchar(50),
  max_cap decimal(10,2),
  discount_amount decimal(10,2),
  percentage decimal(10,2),
  expires_at date
);

create table orders(
  order_id int primary key serial,
  order_time timestamp default current_timestamp,
  status varchar(50) check(status in('pending','delivered','ontheway')),
  user_id int not null,
  foreign key (user_id) references users(user_id)
);

create table delivery(
  delivery_id int primary key serial,
  status varchar(50),
  pickup_time timestamp,
  estimated_arrival timestamp,
  order_id int unique not null,
  rider_id int not null,
  time_slot_id int not null,
  address_id int not null,
  foreign key (address_id) references address(address_id),
  foreign key (order_id) references orders(order_id) on delete cascade,
  foreign key (time_slot_id) references timeslots(time_slot_id),
  foreign key (rider_id) references rider(rider_id)
);

create table payment(
  payment_id int primary key serial,
  method varchar(50),
  payment_time timestamp default current_timestamp,
  status varchar(50),
  order_id int unique not null,
  foreign key (order_id) references orders(order_id) on delete cascade
);



create table order_details(
    order_id int,
    product_id int,
    quantity int not null check(quantity>0),
    price decimal(10, 2) not null,
    primary key (order_id, product_id),
    foreign key (order_id) references orders(order_id),
    foreign key (product_id) references products(product_id)
);

CREATE TABLE product_review (
    review_id serial primary key,
    rating int check(rating >=1 and rating <=5),
    comment text,
    user_id int not null,
    product_id int not null,
    foreign key (user_id) references users(user_id) on delete cascade,
    foreign key (product_id) references products(product_id) on delete cascade
);

create table order_applied_offer(
  order_id int primary key not null,
  offer_id int,
  foreign key (order_id) references orders(order_id) on delete cascade,
  foreign key (offer_id) references order_offer(offer_id) on delete cascade,
);


